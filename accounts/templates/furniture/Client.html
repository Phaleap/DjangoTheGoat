{% load static %}
<section id="client" class="p_3 px-4 carousel_p">
<div class="container-fluid">
    {# --- HARDCODED HEADER (Per User Request) --- #}
    <div class="project_1 row mb-4 text-center">
        <div class="col-md-12">
            <h6 class="col_yell fw-bold">OUR CLIENTS</h6>
            <h1 class="mt-3 mb-0">Here's what our satisfied <br> clients are saying</h1>
        </div>
    </div>
    {# --- END HARDCODED HEADER --- #}
    
  <div class="testim_1 row">
   <div id="carouselExampleCaptions2" class="carousel slide" data-bs-ride="carousel">
 
        {# --- DYNAMIC CAROUSEL INDICATORS --- #}
        <div class="carousel-indicators">
            {% for slide in testimonial_slides %}
                <button type="button" 
                    data-bs-target="#carouselExampleCaptions2" 
                    data-bs-slide-to="{{ forloop.counter0 }}" 
                    class="{% if forloop.first %}active{% endif %}" 
                    aria-label="Slide {{ forloop.counter }}"
                    {% if forloop.first %}aria-current="true"{% endif %}
                ></button>
            {% empty %}
                {# Fallback indicator #}
                <button type="button" data-bs-target="#carouselExampleCaptions2" data-bs-slide-to="0" class="active" aria-label="Slide 1" aria-current="true"></button>
            {% endfor %}
        </div>
        {# --- END DYNAMIC CAROUSEL INDICATORS --- #}

        <div class="carousel-inner">
            {# --- DYNAMIC CAROUSEL SLIDES (EACH SLIDE CONTAINS UP TO 3 TESTIMONIALS) --- #}
            {% for slide in testimonial_slides %}
                <div class="carousel-item {% if forloop.first %}active{% endif %}">
                    <div class="testim_1i row">
                        
                        {# Iterate over the 1-3 testimonials in the current slide group #}
                        {% for testimonial in slide %}
                            <div class="col-md-4">
                                <div class="testim_1i1 bg-light p-4 clearfix">
                                    <span class="d-inline-block bg_yell text-white text-center span_1 rounded-circle"><i class="fa fa-quote-left"></i></span>
                                    
                                    <div class="testim_1i1i clearfix mt-3">
                                        <span>
                                            {# Use testimonial.image.url for the dynamic image #}
                                            <img src="{{ testimonial.image.url }}" alt="{{ testimonial.client_name }}" class="rounded-circle me-3 float-start">
                                        </span>
                                        <h6 class="mb-0 fw-bold text-uppercase lh-base"> 
                                            {{ testimonial.client_name }} <br> 
                                            <span class="col_yell font_14 fw-normal">{{ testimonial.designation }}</span>
                                        </h6>
                                    </div>
                                    <p class="mb-0 mt-3">{{ testimonial.quote }}</p>
                                </div> 
                            </div>
                        {% endfor %}

                        {# Optional: Add empty columns if you need exactly 3 columns per row for styling consistency #}
                        {% with slide|length as count %}
                            {% if count == 1 %}
                                <div class="col-md-4"></div>
                                <div class="col-md-4"></div>
                            {% elif count == 2 %}
                                <div class="col-md-4"></div>
                            {% endif %}
                        {% endwith %}

                    </div>
                </div>
            {% empty %}
                {# Fallback content if no testimonials exist #}
                <div class="carousel-item active">
                    <div class="testim_1i row">
                        <div class="col-md-12 text-center">
                            <p>No testimonials available yet. Please add some in the admin panel.</p>
                        </div>
                    </div>
                </div>
            {% endfor %}
            {# --- END DYNAMIC CAROUSEL SLIDES --- #}
        </div>
    </div>
  </div>
</div>
</section>